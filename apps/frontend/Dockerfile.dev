# =================================================================
# React + VITE Frontend - Development Dockerfile
# í”„ë¡œì íŠ¸: ê´‘ë‚¨ë™ì„±ë‹¹ ì²­ì†Œë…„ìœ„ì›íšŒ ì˜ˆê²°ì‚° ê´€ë¦¬ ì‹œìŠ¤í…œ
# í™˜ê²½: Development
# =================================================================

FROM node:20-alpine

# ë©”íƒ€ë°ì´í„° ì„¤ì •
LABEL maintainer="ê´‘ë‚¨ë™ì„±ë‹¹ ì²­ì†Œë…„ìœ„ì›íšŒ ê°œë°œíŒ€"
LABEL description="React + VITE Frontend Development Container"
LABEL version="1.0.0"

# ê°œë°œ ë„êµ¬ ì„¤ì¹˜ (Alpine Linux)
RUN apk add --no-cache \
    curl \
    git \
    bash \
    vim \
    && rm -rf /var/cache/apk/*

# ì‘ì—… ë””ë ‰í„°ë¦¬ ì„¤ì •
WORKDIR /app

# ì‚¬ìš©ì ë° ê·¸ë£¹ ìƒì„± (ë³´ì•ˆ)
RUN addgroup -g 1001 -S nodejs \
    && adduser -S reactjs -u 1001 -G nodejs

# ì˜ì¡´ì„± ìºì‹±ì„ ìœ„í•œ package íŒŒì¼ë“¤ë§Œ ë¨¼ì € ë³µì‚¬
COPY package*.json ./

# Node.js ì˜ì¡´ì„± ì„¤ì¹˜
RUN npm install \
    && npm cache clean --force

# ê¸€ë¡œë²Œ ë„êµ¬ ì„¤ì¹˜ (ê°œë°œí™˜ê²½ìš©)
# @vitejs/create-viteëŠ” ëŸ°íƒ€ì„ì— ë¶ˆí•„ìš”í•˜ë¯€ë¡œ ì œê±°

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë³µì‚¬
COPY . .

# ë””ë ‰í„°ë¦¬ ê¶Œí•œ ì„¤ì •
RUN mkdir -p /app/dist /app/node_modules \
    && chown -R reactjs:nodejs /app \
    && chmod -R 755 /app

# ì‚¬ìš©ì ì „í™˜
USER reactjs

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
ENV NODE_ENV=development
ENV VITE_HOST=0.0.0.0
ENV VITE_PORT=3000
ENV NODE_OPTIONS="--max-old-space-size=4096"

# í¬íŠ¸ ì„¤ì •
EXPOSE 3000

# í—¬ìŠ¤ì²´í¬ ì„¤ì •
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:3000 || exit 1

# ê°œë°œìš© ì‹œì‘ ëª…ë ¹ì–´ (Hot Module Replacement)
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--port", "3000"]

# =================================================================
# ê°œë°œ ìµœì í™” ì„¤ì •
# =================================================================
# 
# ğŸ”§ ê°œë°œ í¸ì˜ ê¸°ëŠ¥:
#   - Hot Module Replacement (HMR): ì½”ë“œ ë³€ê²½ ì‹œ ì‹¤ì‹œê°„ ë°˜ì˜
#   - Fast Refresh: React ì»´í¬ë„ŒíŠ¸ ìƒíƒœ ìœ ì§€í•˜ë©° ì—…ë°ì´íŠ¸
#   - ì˜ì¡´ì„± ìºì‹±: ë¹ ë¥¸ ë¹Œë“œë¥¼ ìœ„í•œ ë ˆì´ì–´ ìºì‹±
#   - TypeScript: ì‹¤ì‹œê°„ íƒ€ì… ê²€ì‚¬
#
# ğŸ›¡ï¸ ë³´ì•ˆ ì„¤ì •:
#   - Non-root ì‚¬ìš©ì: reactjs ê³„ì •ìœ¼ë¡œ ì‹¤í–‰
#   - ìµœì†Œ ê¶Œí•œ: í•„ìš”í•œ ê¶Œí•œë§Œ ë¶€ì—¬
#   - Alpine Linux: ê²½ëŸ‰í™” ë° ë³´ì•ˆ ê°•í™”
#
# ğŸš€ ì„±ëŠ¥ ìµœì í™”:
#   - ì˜ì¡´ì„± ë ˆì´ì–´ ë¶„ë¦¬: package.json ë³€ê²½ì‹œì—ë§Œ ì¬ì„¤ì¹˜
#   - ë©”ëª¨ë¦¬ ì„¤ì •: ê°œë°œìš© ì¶©ë¶„í•œ ë©”ëª¨ë¦¬ í• ë‹¹
#   - npm ìºì‹œ ì •ë¦¬: ì´ë¯¸ì§€ í¬ê¸° ìµœì í™”
#   - VITE ìµœì í™”: ë¹ ë¥¸ ê°œë°œ ì„œë²„ ë° HMR
# =================================================================